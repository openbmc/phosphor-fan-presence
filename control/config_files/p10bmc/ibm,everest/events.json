[
   {
     // Hold fans at the given target when a number of fans are missing.
     "name": "fan(s) missing",
     "groups": [
       {
         "name": "fan inventory",
         "interface": "xyz.openbmc_project.Inventory.Item",
         "property": { "name": "Present" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "count_state_before_target",
         "count": 1,
         "state": false,
         "target": 10700
       }
     ]
   },
   {
     // Hold fans at the given target when a number of rotors are nonfunctional.
     "name": "fan rotor(s) faulted",
     "groups": [
       {
         "name": "fan0 rotor inventory",
         "interface": "xyz.openbmc_project.State.Decorator.OperationalStatus",
         "property": { "name": "Functional" }
       },
       {
         "name": "fan1 rotor inventory",
         "interface": "xyz.openbmc_project.State.Decorator.OperationalStatus",
         "property": { "name": "Functional" }
       },
       {
         "name": "fan2 rotor inventory",
         "interface": "xyz.openbmc_project.State.Decorator.OperationalStatus",
         "property": { "name": "Functional" }
       },
       {
         "name": "fan3 rotor inventory",
         "interface": "xyz.openbmc_project.State.Decorator.OperationalStatus",
         "property": { "name": "Functional" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "count_state_before_target",
         "count": 1,
         "state": false,
         "target": 10700
       }
     ]
   },
   {
     // Hold fans at the given target when any critical service
     // is not running for 5 seconds.
     "name": "service(s) missing",
     "groups": [
       {
         "name": "occ objects",
         "interface": "org.open_power.OCC.Status",
         "property": { "name": "OccActive" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "name_has_owner"
       },
       {
         "class": "signal",
         "signal": "name_owner_changed"
       }
     ],
     "actions": [
       {
         "name": "call_actions_based_on_timer",
         "timer": {
           "interval": 5000000,
           "type": "oneshot"
         },
         "actions": [
           {
             "name": "set_target_on_missing_owner",
             "groups": [
               {
                 "name": "fan inventory",
                 "interface": "xyz.openbmc_project.Inventory.Item",
                 "property": { "name": "Present" }
               },
               {
                 "name": "occ objects",
                 "interface": "org.open_power.OCC.Status",
                 "property": { "name": "OccActive" }
               }
             ],
             "target": 10700
           }
         ]
       }
     ]
   },
   {
    // Set the floor based on the power mode and altitude
     "name": "power mode floor",
     "groups": [
      {
        "name": "power mode",
        "interface": "xyz.openbmc_project.Control.Power.Mode",
        "property": { "name": "PowerMode" }
      },
      {
        "name": "ambient temp",
        "interface": "xyz.openbmc_project.Sensor.Value",
        "property": {
          "name": "Value"
        }
      },
      {
        "name": "altitude",
        "interface": "xyz.openbmc_project.Sensor.Value",
        "property": {
          "name": "Value"
        }
      }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "mapped_floor",
         "key_group": "ambient temp",
         "fan_floors": [
          {
            // Entry valid for temps < 28
            "key": 28,
            "floors": [
              {
                "group": "power mode",
                "floors": [
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.MaximumPerformance",
                    "floor": 4300
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.PowerSaving",
                    "floor": 3800
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.Static",
                    "floor": 4300
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.OEM",
                    "floor": 4300
                  }
                ]
              },
              {
                "group": "altitude",
                "floors": [
                  {
                    "value": 500,
                    "floor": 4300
                  },
                  {
                    "value": 1500,
                    "floor": 4800
                  },
                  {
                    "value": 2500,
                    "floor": 5500
                  },
                  {
                    "value": 3500,
                    "floor": 6400
                  }
                ]
              }
            ]
          },
          {
            // Entry valid for temps >= 28
            "key": 255,
            "floors": [
              {
                "group": "power mode",
                "floors": [
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.MaximumPerformance",
                    "floor": 6400
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.PowerSaving",
                    "floor": 5900
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.Static",
                    "floor": 6400
                  },
                  {
                    "value": "xyz.openbmc_project.Control.Power.Mode.PowerMode.OEM",
                    "floor": 6400
                  }
                ]
              },
              {
                "group": "altitude",
                "floors": [
                  {
                    "value": 500,
                    "floor": 4300
                  },
                  {
                    "value": 1500,
                    "floor": 4800
                  },
                  {
                    "value": 2500,
                    "floor": 5500
                  },
                  {
                    "value": 3500,
                    "floor": 6400
                  }
                ]
              }
            ]
          }
        ]
       }
     ]
   },
   {
     "name": "Set Proc 0 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 0 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_0_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 1 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 1 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_1_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 2 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 2 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_2_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 3 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 3 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_3_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 4 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 4 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_4_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 5 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 5 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_5_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 6 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 6 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_6_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 7 Core DVFS parameter",
     "groups": [
       {
         "name": "proc 7 core dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_7_core_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 0 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 0 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_0_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 1 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 1 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_1_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 2 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 2 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_2_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 3 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 3 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_3_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 4 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 4 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_4_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 5 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 5 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_5_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 6 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 6 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_6_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   },
   {
     "name": "Set Proc 7 IO Ring DVFS parameter",
     "groups": [
       {
         "name": "proc 7 ioring dvfs temp",
         "interface": "xyz.openbmc_project.Sensor.Value",
         "property": { "name": "Value" }
       }
     ],
     "triggers": [
       {
         "class": "init",
         "method": "get_properties"
       },
       {
         "class": "signal",
         "signal": "interfaces_added"
       },
       {
         "class": "signal",
         "signal": "properties_changed"
       }
     ],
     "actions": [
       {
         "name": "set_parameter_from_group_max",
         "parameter_name": "proc_7_ioring_dvfs_temp",
         "modifier": {
             "operator": "minus",
             "value": 3
         }
       }
     ]
   }
]
